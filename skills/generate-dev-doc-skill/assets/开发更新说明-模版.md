# 开发文档更新说明

**需求标题**：【260130】【小包问题件】操作流程优化  
**模块**：
1. 销售管理-订单管理-外销订单-全平台
2. 发货管理-物流跟踪-跟踪列表 
**开发分支**：master

## 修改概述

本次更新主要实现了以下功能：

1. **全平台订单列表**：订单「状态」中带问题件的订单，「问题件」文案改为按钮，支持下拉操作（问题处理、作废、处理完结），点击后调用小包物流问题件操作弹窗；已作废订单增加问题件标识。
2. **物流跟踪列表**：发货管理-物流跟踪-跟踪列表-全部中，「订单状态」与全平台一致，增加问题件标识及相同的问题件操作入口。

---

## 执行SQL清单
（本次未涉及数据表状态、字段/索引更新。）

## 修改文件清单

### 1. 后端控制器（3）

- `application/admin/controller/module/delivery/Tracking.php`
  - 修改行数：+27 行，-0 行（跟踪列表返回问题件信息，与全平台一致的问题件操作入口）
- `application/admin/controller/module/sales/order/Logisticsproblem.php`
  - 修改行数：+4 行，-4 行（小包问题件操作弹窗与接口复用支持）
- `application/admin/controller/module/sales/order/Platform.php`
  - 修改行数：+26 行，-0 行（全平台列表问题件标识与下拉操作、已作废订单问题件标识）

### 2. 前端JavaScript（2）

- `public/assets/js/backend/module/delivery/tracking.js`
  - 修改行数：+62 行，-2 行（跟踪列表问题件按钮、下拉及操作弹窗）
- `public/assets/js/backend/module/sales/order/platform.js`
  - 修改行数：+63 行，-9 行（全平台问题件按钮、下拉及操作弹窗）

---

## 代码更新后部署清单
（本次无定时脚本、守护进程等部署项。）

## 功能详细说明

### 1. 全平台订单列表 - 问题件标识与操作

- **功能描述**：外销订单-全平台列表中，订单状态为「问题件」的订单，将「问题件」文本改为可点击按钮；鼠标移入显示下拉框，根据小包问题件状态展示「问题处理」「作废」「处理完结」等操作；点击后调用小包物流问题件中的操作弹窗，请求与结果一致。已作废订单也展示问题件标识（若存在小包问题件记录）。
- **实现逻辑**：列表接口/前端根据订单 `is_problem` 及 `logistics_order_problem` 中该订单的可操作记录（如 status 非完结/作废）展示按钮与下拉；操作接口复用小包问题件控制器（如 Logisticsproblem）的弹窗与请求。
- **代码位置**：
  1. `application/admin/controller/module/sales/order/Platform.php`
  2. `public/assets/js/backend/module/sales/order/platform.js`

### 2. 物流跟踪列表 - 问题件标识与操作

- **功能描述**：发货管理-物流跟踪-跟踪列表-全部中，订单状态列与全平台一致，增加问题件标识及相同的问题件下拉操作（问题处理、作废、处理完结），点击后同样调用小包问题件操作弹窗。
- **实现逻辑**：跟踪列表接口返回问题件相关信息，前端展示逻辑与全平台一致，操作入口调用同一套小包问题件接口与弹窗。
- **代码位置**：
  1. `application/admin/controller/module/delivery/Tracking.php`
  2. `public/assets/js/backend/module/delivery/tracking.js`

### 3. 问题件标识与 is_problem 说明

- **说明**：订单表 `hw_order.is_problem` 仅由小包问题件相关逻辑维护；标识与可操作项建议以「是否存在可操作的小包问题件记录」为准，避免依赖可能不一致的 is_problem 做关键逻辑。若本目录下有 `is_problem字段说明.md` 可一并参阅。

---

## 数据库影响

- 本次未新增或修改表结构。
- 涉及字段：`hw_order.is_problem`、表 `logistics_order_problem` 的查询与业务逻辑（无结构变更）。

---

## 业务规则

- 问题件操作权限与展示与【小包物流问题件】菜单内一致：待销售处理/草稿可「问题处理」「作废」；待物控处理可「问题处理」「作废」「处理完结」。
- 已作废订单若存在小包问题件记录，仍展示「问题件」标识，可进入查看或操作（与现有小包问题件规则一致）。

---

## 测试要点

- [ ] 全平台订单列表：带问题件的订单「问题件」为按钮，移入显示下拉，操作项与状态匹配（待销售/草稿/待物控）。
- [ ] 全平台：点击「问题处理」「作废」「处理完结」均调起小包问题件操作弹窗，提交后结果与在小包问题件菜单内操作一致。
- [ ] 全平台：已作废订单若为问题件，列表中显示问题件标识并可操作。
- [ ] 物流跟踪-全部列表：订单状态列展示问题件标识及下拉操作，行为与全平台一致。
- [ ] 无问题件订单不显示问题件按钮/标识；is_problem=1 但无可操作记录时仅显示「问题件」文案、不展示下拉（若已按此实现）。

---

## 注意事项

- 当前在 master 分支时无法使用脚本生成本文档，本文档基于未提交变更整理；建议在功能分支上开发并再次运行 generate-dev-doc 脚本以同步文件清单。
- 问题件接口与权限需与【小包物流问题件】菜单保持一致，避免跨菜单权限不一致。

---

## 版本信息

- **分支**：master
- **修改日期**：2025-01-30
- **修改人**：xiaoxiaoming

---

## 相关文档

- 需求说明：本目录下 `需求说明.md`
- 字段说明：本目录下 `is_problem字段说明.md`（如有）
