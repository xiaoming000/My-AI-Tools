---
name: generate-dev-doc-skill
description: 根据当前分支（非master）与master对比或未提交文件及需求文档，生成符合标准格式的开发更新说明文档。当用户需要生成开发更新说明、更新说明或记录代码变更时使用。
---

# 生成开发文档更新说明

根据 Git 变更与需求文档，生成与模版格式一致的开发更新说明文档。脚本仅负责执行 Git 命令并输出数据，文档结构与内容以模版为准、由 Agent 填写。

## 快速开始

当用户需要生成开发文档更新说明时：

1. **获取当前分支**：执行 `scripts/get-branch.sh`（需在仓库根目录或传入工作区路径）。
2. **获取 Git 修改文件清单**：
   - 当前非 master 分支时：使用 `scripts/get-changed-files.sh`，内部执行 `git diff --name-status master...HEAD`。
   - 当前为 master 分支时：使用同一脚本，内部执行 `git status --porcelain` 获取未提交修改。
3. **（可选）获取修改行数**：对上述文件列表执行 `scripts/get-diff-stat.sh`，传入文件路径列表。
4. **（可选）按模版分类**：将文件列表传入 `scripts/categorize-files.php`，得到与模版一致的后端控制器/前端JS等分类。
5. **生成2个文档**：
   1. 开发更新说明：根据修改清单、需求文档（如有），与 **`assets/开发更新说明-模版.md`** 的格式与备注要求，生成一份完整文档；模版中的「备注说明」即对各段的填写要求。
   2. 上线检查清单：根据修改清单、需求文档（如有）和上面生成的开发更新说明文档，与 **`assets/上线检查清单-模版.md`** 的格式与备注要求，生成一份完整文档；模版中的「备注说明：」即对各段的填写要求。

## 重点

- **必须确保修改文件清单的文件数量不缺失**：以脚本输出的文件列表为准，生成文档时不得遗漏或擅自过滤。模版中的「备注说明：」即对各段的填写要求，不能生成。
- **严格按照模版章节**：只生成模版中的章节，禁止添加模版外的章节（如"上线步骤建议"、"上线顺序与检查要点"、"核心检查点"、"影响范围"、"Bug修复记录"、"相关文档"等）。
- **"是否"问题处理**：不涉及时前加❌保持`是**否**`；涉及时前加✅改为`**是**否`并下方补充内容。不要另起行单独写"**是**"或"**否**"。
- **简洁原则**：避免冗长描述和废话，内容简明扼要。

## 脚本说明

| 脚本 | 类型 | 作用 |
|------|------|------|
| `scripts/get-branch.sh` | Shell | 输出当前 Git 分支名 |
| `scripts/get-changed-files.sh` | Shell | 根据是否在 master 分支，输出变更文件列表（diff master 或 porcelain） |
| `scripts/get-diff-stat.sh` | Shell | 对传入的文件路径执行 `git diff --stat`，输出每个文件的增删行数 |
| `scripts/categorize-files.php` | PHP | 读取文件路径列表，按模版分类（后端控制器、前端JS 等）输出 |

脚本不负责生成或校验文档格式，只输出 Git 相关数据；文档格式与章节以模版为准，由 Agent 按模版填写。

## 安装与依赖

- **Shell 脚本**：需在 Git 仓库内执行；Windows 下可用 Git Bash 或 WSL 运行。
- **PHP 脚本**：需已安装 PHP CLI（`php -v` 可用）；无额外扩展要求，从 stdin 或参数读取路径列表。

技能目录建议放在工作区或用户目录的 `.cursor/skills/generate-dev-doc-skill`，脚本路径以该技能根目录为基准（如 `./scripts/get-branch.sh`）。

## 模版

- 路径：**`assets/开发更新说明-模版.md`**
- 生成文档的标题、章节顺序、分类名称及「修改文件清单」中的分类（后端模型/后端仓储/后端服务/后端控制器、前端视图、前端JS、前端CSS、其他）均以该模版为准；模版中的「备注说明」为对各段的填写要求，后续优化模版即可统一更新生成规范。
